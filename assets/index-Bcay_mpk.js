(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const X=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r})=>{const c=X(),a=c.querySelector(".card__like-button"),Q=c.querySelector(".card__control-button_type_delete"),F=c.querySelector(".card__control-button_type_info"),S=c.querySelector(".card__image");return S.src=e.link,S.alt=e.name,c.querySelector(".card__title").textContent=e.name,o&&a.addEventListener("click",()=>o(a)),n&&Q.addEventListener("click",()=>n(c)),r&&F&&F.addEventListener("click",()=>r()),t&&S.addEventListener("click",()=>t({name:e.name,link:e.link})),c},U=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");t&&i(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",U)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",U)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})},Z=(e,t,o,n,r)=>{const c=e.querySelector(`#${t.id}-error`);t.classList.add(n),c.textContent=o,c.classList.add(r)},N=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o),r.classList.remove(n),r.textContent=""},ee=(e,t,o,n)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?N(e,t,o,n):Z(e,t,t.validationMessage,o,n)},te=e=>e.some(t=>!t.validity.valid),$=(e,t)=>{e.classList.add(t),e.disabled=!0},oe=(e,t)=>{e.classList.remove(t),e.disabled=!1},T=(e,t,o)=>{te(e)?$(t,o):oe(t,o)},re=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);T(o,n,t.inactiveButtonClass),o.forEach(r=>{r.addEventListener("input",function(){ee(e,r,t.inputErrorClass,t.errorClass),T(o,n,t.inactiveButtonClass)})})},ne=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>{n.preventDefault()}),re(o,e)})},E=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{N(e,r,t.inputErrorClass,t.errorClass)}),$(n,t.inactiveButtonClass)},A={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"edded6d7-9924-4602-932a-1740102b3dcf","Content-Type":"application/json"}},ce=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),l=(e,t={})=>fetch(`${A.baseUrl}${e}`,{headers:A.headers,...t}).then(ce),se=()=>l("/users/me"),H=()=>l("/cards"),ie=({name:e,about:t})=>l("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})}),le=({avatar:e})=>l("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})}),ae=({name:e,link:t})=>l("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})}),ue=e=>l(`/cards/${e}`,{method:"DELETE"}),pe=(e,t)=>l(`/cards/likes/${e}`,{method:t?"DELETE":"PUT"}),y=document.querySelector(".popup_type_info"),de=y.querySelector(".popup__title"),m=y.querySelector(".popup__info"),D=y.querySelector(".popup__list"),_e=document.querySelector("#popup-info-definition-template").content,me=document.querySelector("#popup-info-user-preview-template").content,V=document.querySelector(".places__list"),I=document.querySelector(".popup_type_edit"),_=I.querySelector(".popup__form"),j=_.querySelector(".popup__input_type_name"),J=_.querySelector(".popup__input_type_description"),w=document.querySelector(".popup_type_new-card"),u=w.querySelector(".popup__form"),fe=u.querySelector(".popup__input_type_card-name"),ye=u.querySelector(".popup__input_type_url"),g=document.querySelector(".popup_type_remove-card"),h=g.querySelector(".popup__form"),q=u.querySelector(".popup__button"),M=document.querySelector(".popup_type_image"),W=M.querySelector(".popup__image"),ve=M.querySelector(".popup__caption"),Se=document.querySelector(".profile__edit-button"),he=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),L=_.querySelector(".popup__button"),f=document.querySelector(".popup_type_edit-avatar"),d=f.querySelector(".popup__form"),qe=d.querySelector(".popup__input"),b=d.querySelector(".popup__button"),k=function(e,t){e.querySelector(".card__like-count").textContent=t},s=function(e,t){e.textContent=t},v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ne(v);const Le=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),C=(e,t)=>{const o=_e.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},R=e=>{H().then(t=>{const o=t.find(n=>n._id===e);o&&(de.textContent=o.name,m.innerHTML="",D.innerHTML="",m.append(C("Дата создания:",Le(new Date(o.createdAt)))),m.append(C("Владелец:",o.owner.name)),m.append(C("Количество лайков:",o.likes.length)),o.likes.forEach(n=>{const r=me.cloneNode(!0);r.querySelector(".popup__list-item").textContent=n.name,D.append(r)}),p(y))}).catch(t=>{console.log(t)})},z=({name:e,link:t})=>{W.src=t,W.alt=e,ve.textContent=e,p(M)},be=e=>{e.preventDefault(),s(L,"Сохранение..."),ie({name:j.value,about:J.value}).then(t=>{P.textContent=t.name,B.textContent=t.about,s(L,"Сохранить"),i(I)}).catch(t=>{s(L,"Сохранить"),console.log(t)})},Ce=e=>{e.preventDefault(),s(b,"Сохранение..."),le({avatar:qe.value}).then(t=>{x.style.backgroundImage=`url(${t.avatar})`,s(b,"Сохранить"),i(f)}).catch(t=>{i(f),s(b,"Сохранить"),console.log(t)})},ge=e=>{e.preventDefault(),s(q,"Создание..."),ae({name:fe.value,link:ye.value}).then(t=>{V.prepend(O(t,{onPreviewPicture:z,onLikeIcon:o=>G(o,t._id),onDeleteCard:o=>K(o,t._id),onInfoClick:()=>R(t._id)})),s(q,"Создать"),i(w)}).catch(t=>{s(q,"Создать"),console.log(t)})},K=(e,t)=>{p(g);const o=n=>{n.preventDefault();const r=h.querySelector(".popup__button");s(r,"Удаление..."),ue(t).then(()=>{i(g),e.remove(),s(r,"Да")}).catch(c=>{console.log(c),s(r,"Да")}).finally(()=>{h.removeEventListener("submit",o)})};h.addEventListener("submit",o)},G=(e,t)=>{const o=e.classList.contains("card__like-button_is-active");pe(t,o).then(n=>{n.likes.length===0?(e.classList.remove("card__like-button_is-active"),k(e.parentElement,"")):(k(e.parentElement,n.likes.length),e.classList.toggle("card__like-button_is-active"))}).catch(n=>{console.log(n)})};_.addEventListener("submit",be);u.addEventListener("submit",ge);d.addEventListener("submit",Ce);Se.addEventListener("click",()=>{j.value=P.textContent,J.value=B.textContent,p(I),E(_,v)});x.addEventListener("click",()=>{d.reset(),p(f),E(d,v)});he.addEventListener("click",()=>{u.reset(),p(w),E(u,v)});const ke=document.querySelectorAll(".popup");ke.forEach(e=>{Y(e)});Promise.all([H(),se()]).then(([e,t])=>{e.forEach(o=>{const n=O(o,{onPreviewPicture:z,onLikeIcon:r=>G(r,o._id),onDeleteCard:r=>K(r,o._id),onInfoClick:()=>R(o._id)});if(o.owner._id!==t._id){const r=n.querySelector(".card__control-button_type_delete");r&&r.remove()}V.append(n),o.likes.find(r=>r._id===t._id)&&n.querySelector(".card__like-button").classList.add("card__like-button_is-active"),k(n,o.likes.length>0?o.likes.length:"")}),B.textContent=t.about,P.textContent=t.name,x.style.backgroundImage=`url(${t.avatar})`}).catch(e=>{console.log(e)});
