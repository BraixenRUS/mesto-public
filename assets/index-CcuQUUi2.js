(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const Y=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:r,onInfoClick:n},c)=>{const s=Y(),S=s.querySelector(".card__like-button"),T=s.querySelector(".card__control-button_type_delete"),A=s.querySelector(".card__control-button_type_info"),v=s.querySelector(".card__image"),F=s.querySelector(".card__like-count");return v.src=e.link,v.alt=e.name,s.querySelector(".card__title").textContent=e.name,F.textContent=e.likes.length,e.likes.some(X=>X._id===c)&&S.classList.add("card__like-button_is-active"),o&&S.addEventListener("click",()=>o(S,e._id,F)),e.owner._id!==c?T.style.display="none":r&&T.addEventListener("click",()=>r(s,e._id)),n&&A&&A.addEventListener("click",()=>n(e)),t&&v.addEventListener("click",()=>t({name:e.name,link:e.link})),s},Z=e=>{e.classList.toggle("card__like-button_is-active")},U=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");t&&i(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",U)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",U)},ee=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})},te=(e,t,o,r,n)=>{const c=e.querySelector(`#${t.id}-error`);t.classList.add(r),c.textContent=o,c.classList.add(n)},W=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o),n.classList.remove(r),n.textContent=""},oe=(e,t,o,r)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?W(e,t,o,r):te(e,t,t.validationMessage,o,r)},ne=e=>e.some(t=>!t.validity.valid),V=(e,t)=>{e.classList.add(t),e.disabled=!0},re=(e,t)=>{e.classList.remove(t),e.disabled=!1},M=(e,t,o)=>{ne(e)?V(t,o):re(t,o)},ce=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);M(o,r,t.inactiveButtonClass),o.forEach(n=>{n.addEventListener("input",function(){oe(e,n,t.inputErrorClass,t.errorClass),M(o,r,t.inactiveButtonClass)})})},se=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",r=>{r.preventDefault()}),ce(o,e)})},b=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{W(e,n,t.inputErrorClass,t.errorClass)}),V(r,t.inactiveButtonClass)},N={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"edded6d7-9924-4602-932a-1740102b3dcf","Content-Type":"application/json"}},ie=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),u=(e,t)=>fetch(`${N.baseUrl}${e}`,{headers:N.headers,...t}).then(ie),le=()=>u("/users/me"),ue=()=>u("/cards"),ae=(e,t)=>u("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})}),pe=e=>u("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})}),de=(e,t)=>u("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})}),_e=e=>u(`/cards/${e}`,{method:"DELETE"}),me=(e,t)=>u(`/cards/likes/${e}`,{method:t?"DELETE":"PUT"}),H=document.querySelector(".places__list"),g=document.querySelector(".popup_type_edit"),_=g.querySelector(".popup__form"),j=_.querySelector(".popup__input_type_name"),J=_.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),l=k.querySelector(".popup__form"),fe=l.querySelector(".popup__input_type_card-name"),ye=l.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),D=E.querySelector(".popup__image"),Se=E.querySelector(".popup__caption"),ve=document.querySelector(".profile__edit-button"),he=document.querySelector(".profile__add-button"),x=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),w=document.querySelector(".popup_type_edit-avatar"),d=w.querySelector(".popup__form"),qe=d.querySelector(".popup__input"),P=document.querySelector(".popup_type_remove-card"),R=P.querySelector(".popup__form"),f=document.querySelector(".popup_type_info"),Ce=f.querySelector(".popup__title"),m=f.querySelector(".popup__info"),O=f.querySelector(".popup__list"),Le=document.querySelector("#popup-info-definition-template").content,be=document.querySelector("#popup-info-user-preview-template").content;let q=null,C=null,L=null;const y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function a(e,t,o="Сохранить"){t?e.textContent="Сохранение...":e.textContent=o}const ge=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),h=(e,t)=>{const o=Le.cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},z=({name:e,link:t})=>{D.src=t,D.alt=e,Se.textContent=e,p(E)},K=(e,t,o)=>{const r=e.classList.contains("card__like-button_is-active");me(t,r).then(n=>{Z(e),o.textContent=n.likes.length}).catch(n=>console.log(n))},G=(e,t)=>{C=t,L=e,p(P)},Q=e=>{Ce.textContent=e.name,m.innerHTML="",O.innerHTML="",m.append(h("Дата создания:",ge(e.createdAt))),m.append(h("Владелец:",e.owner.name)),m.append(h("Количество лайков:",e.likes.length)),e.likes.forEach(t=>{const o=be.cloneNode(!0);o.querySelector(".popup__list-item").textContent=t.name,O.append(o)}),p(f)},ke=e=>{e.preventDefault();const t=_.querySelector(".popup__button");a(t,!0),ae(j.value,J.value).then(o=>{x.textContent=o.name,B.textContent=o.about,i(g)}).catch(o=>console.log(o)).finally(()=>a(t,!1))},Ee=e=>{e.preventDefault();const t=d.querySelector(".popup__button");a(t,!0),pe(qe.value).then(o=>{I.style.backgroundImage=`url(${o.avatar})`,i(w)}).catch(o=>console.log(o)).finally(()=>a(t,!1))},xe=e=>{e.preventDefault();const t=l.querySelector(".popup__button");a(t,!0,"Создать"),de(fe.value,ye.value).then(o=>{const r=$(o,{onPreviewPicture:z,onLikeIcon:K,onDeleteCard:G,onInfoClick:Q},q);H.prepend(r),i(k),l.reset()}).catch(o=>console.log(o)).finally(()=>a(t,!1,"Создать"))},Be=e=>{if(e.preventDefault(),!C||!L)return;const t=R.querySelector(".popup__button"),o=t.textContent;t.textContent="Удаление...",_e(C).then(()=>{L.remove(),i(P)}).catch(r=>console.log(r)).finally(()=>{t.textContent=o})};_.addEventListener("submit",ke);l.addEventListener("submit",xe);d.addEventListener("submit",Ee);R.addEventListener("submit",Be);ve.addEventListener("click",()=>{j.value=x.textContent,J.value=B.textContent,b(_,y),p(g)});I.addEventListener("click",()=>{d.reset(),b(d,y),p(w)});he.addEventListener("click",()=>{l.reset(),b(l,y),p(k)});document.querySelectorAll(".popup").forEach(e=>{ee(e)});Promise.all([le(),ue()]).then(([e,t])=>{q=e._id,x.textContent=e.name,B.textContent=e.about,I.style.backgroundImage=`url(${e.avatar})`,t.forEach(o=>{const r=$(o,{onPreviewPicture:z,onLikeIcon:K,onDeleteCard:G,onInfoClick:Q},q);H.append(r)})}).catch(e=>console.log(e));se(y);
